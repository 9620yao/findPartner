<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yc.ssm.mapper.SpeaksMapper">
	<resultMap type="PaginationBean" id="PaginationBeanMap">
		<collection property="rows"
			column="{pageSize=pageSize,currPage=currPage,speakman=speakman}"
			ofType="com.yc.ssm.entity.Speaks" select="GetPartTea" />
	</resultMap>
	
	<select id="PbeanSpeaks" parameterType="java.util.Map"
		resultMap="PaginationBeanMap" useCache="false" flushCache="true">
		select
		count(1) total,ceil(count(1) / ${pBean.pageSize})
		totalPage,${pBean.currPage}
		currPage,${pBean.pageSize}
		pageSize,#{speakman} speakman
		from
		speaks where
		speakman=#{speakman}
	</select>

	<select id="GetPartTea" resultType="com.yc.ssm.entity.Speaks">
		select t.* from (
		select
		n.*,rownum rn from (
		select * from speaks where
		speakman=#{speakman}) n
		where ${currPage} *
		${pageSize} >= rownum) t where
		rn > (${currPage}-1)
		* ${pageSize}
	</select>

	<insert id="addSpeaks" parameterType="Speaks">
		insert into
		speaks(sid,content,speakman,senddate)
		values('s'||seq_speaks_sid.nextval,#{content},#{speakman}
		,to_char(sysdate,'yyyy-MM-dd HH:mi:ss'))
	</insert>
</mapper>
